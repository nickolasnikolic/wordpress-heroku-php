jQuery(document).ready(function(e){function i(){window.ci_orig_send_text=wp.media.view.l10n.insertIntoPost,window.ci_orig_send_attachment=wp.media.editor.send.attachment}function a(){wp.media.editor.send.attachment=window.ci_orig_send_attachment,wp.media.view.l10n.insertIntoPost=window.ci_orig_send_text}function n(){window.ci_orig.wp_media_editor_add=wp.media.editor.add,window.ci_orig.wp_media_view_l10n_createNewGallery=wp.media.view.l10n.createNewGallery,window.ci_orig.wp_media_view_l10n_insertGallery=wp.media.view.l10n.insertGallery}function t(){wp.media.editor.add=window.ci_orig.wp_media_editor_add,wp.media.view.l10n.createNewGallery=window.ci_orig.wp_media_view_l10n_createNewGallery,wp.media.view.l10n.insertGallery=window.ci_orig.wp_media_view_l10n_insertGallery}function d(i){var a=[];e(i).children(".thumb").children("img").each(function(){a.push(e(this).data("img-id"))}),i.siblings(".ci-upload-to-gallery-ids").val(a.join(","))}function r(i){var a=i.children(".ci-upload-to-gallery-ids"),n=i.children(".ci-upload-to-gallery-preview");e.ajax({type:"post",url:ciMediaManager.ajaxurl,data:{action:"ci_featgal_AJAXPreview",ids:a.val()},dataType:"text",beforeSend:function(){n.empty().html("<p>"+ciMediaManager.tLoading+"</p>")},success:function(i){"FAIL"==i?n.empty().html("<p>"+ciMediaManager.tPreviewUnavailable+"</p>"):(i=e.parseJSON(i),n.empty(),e.each(i,function(i,a){e('<div class="thumb"><img src="'+a.url+'" data-img-id="'+a.id+'"><a href="#" class="close media-modal-icon" title="'+ciMediaManager.tRemoveFromGallery+'"></a></div>').appendTo(n)}))}})}var l=new Object;window.ci_orig=l,e("body").on("click",".ci-upload",function(n){n.preventDefault(),i();var t=e(this),d=t.siblings(".uploaded"),r=t.siblings(".uploaded-id");wp.media.view.l10n.insertIntoPost=ciMediaManager.tUseThisFile,wp.media.editor.send.attachment=function(e,i){return d.length>0&&d.val("image"==i.type?"undefined"!=typeof i.sizes?i.sizes[e.size].url:i.url:i.url),r.length>0&&r.val(i.id).trigger("change"),a()};wp.media.editor.open(t);return!1}),e("body").on("click",".ci-media-manager-gallery .thumb a.close",function(i){i.preventDefault();var a=e(this).parent().parent();e(this).parent().remove(),d(a)});var o=e(".ci-upload-to-gallery-preview");o.length>0&&o.sortable({update:function(){d(e(this))}}),e("body").on("click",".ci-upload-to-gallery",function(i){i.preventDefault(),n();var a=e(this),d=a.parents(".ci-media-manager-gallery"),l=a.siblings(".ci-upload-to-gallery-ids"),o=a.siblings("p").find('.ci-upload-to-gallery-random > input[type="checkbox"]');if(wp.media.view.l10n.insertGallery=ciMediaManager.tUpdateGallery,"undefined"!=typeof wp&&wp.media&&wp.media.gallery){var c,p=wp.media.gallery,w=l.val();0==w.length&&(w="0");var s=1==o.prop("checked")?'orderby="rand"':"";c=p.edit('[gallery ids="'+w+'" '+s+" ]"),c.state("gallery-edit").on("update",function(e){var i=e.props.toJSON(),a=_.pick(i,"orderby","order");e.gallery&&_.extend(a,e.gallery.toJSON()),a.ids=e.pluck("id"),a._orderbyRandom?(a.orderby="rand",o.prop("checked",!0)):o.removeProp("checked"),delete a._orderbyRandom,l.val(a.ids.join(",")),r(d)},this),t()}})});